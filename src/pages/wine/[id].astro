---
const { id } = Astro.params;
const STRAPI_URL = import.meta.env.PUBLIC_STRAPI_URL;
const STRAPI_API_TOKEN = import.meta.env.PUBLIC_STRAPI_API_TOKEN;

const response = await fetch(`${STRAPI_URL}/api/wines/${id}?populate=*`, {
  headers: {
    'Authorization': `Bearer ${STRAPI_API_TOKEN}`
  }
});
const { data: wine } = await response.json();

export async function getStaticPaths() {
  const response = await fetch(`${STRAPI_URL}/api/wines?populate=*`, {
    headers: {
      'Authorization': `Bearer ${STRAPI_API_TOKEN}`
    }
  });
  const { data: wines } = await response.json();
  return wines.map((wine) => ({
    params: { id: wine.id.toString() },
  }));
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{wine.attributes.Name} - Wine Blog</title>
  </head>
  <body>
    <h1>{wine.attributes.Name}</h1>
    <p>Vintage: {wine.attributes.Vintage}</p>
    <p>Type: {wine.attributes.Type}</p>
    <p>Rating: {wine.attributes.Rating}/5</p>
    <p>{wine.attributes.Description}</p>
    <a href="/">Back to Wine List</a>
  </body>
</html>

<style>
  body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    color: #333;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }
  h1 {
    color: #8B0000;
  }
  a {
    display: inline-block;
    background: #8B0000;
    color: #fff;
    padding: 10px 15px;
    text-decoration: none;
    border-radius: 5px;
  }
</style>